<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Modern 3-Color Bubble Table</title>
  <style>
    :root {
      --border-soft: #1e293b;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      /* 3-row band colors */
      --row-1: #062a35;
      --row-2: #0a435d;
      --row-3: #0d5f89;
      /* Status colors (text only) */
      --status-error-text: #fecaca;
      --status-warning-text: #fef3c7;
      --status-success-text: #bbf7d0;
      /* per-column widths (px or %) */
      --col-1-width: 12%;
      --col-2-width: 21%;
      --col-3-width: 8%;
      --col-4-width: 7%;
      --col-5-width: 6%;
      --col-6-width: 3%;
      --col-7-width: 3%;
      --col-8-width: 3%;
      --col-9-width: 7%;
      --col-10-width: 7%;
      --col-11-width: 7%;
      --col-12-width: 8%;
      --col-13-width: 8%;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #020617;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .wrapper {
      width: 100%;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: clamp(1.7rem, 2.5vw, 2.2rem);
      margin: 0 0 6px;
      letter-spacing: 0.04em;
    }

    .card {
      background: radial-gradient(circle at top left, #4B5D6E, #4B5D6E);
      border-radius: 18px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.06);
      padding: 18px 18px 18px;
      overflow: hidden;
      backdrop-filter: blur(16px);
    }

    /* Header wrapper cell */
    .header-cell-wrapper {
      background-color: #111a27;
      padding: 20;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    /* Header grid that matches bubble-main */
    .header-main {
      display: grid;
      grid-template-columns:
        var(--col-1-width) var(--col-2-width) var(--col-3-width) var(--col-4-width) var(--col-5-width) var(--col-6-width) var(--col-7-width) var(--col-8-width) var(--col-9-width) var(--col-10-width) var(--col-11-width) var(--col-12-width) var(--col-13-width);
      margin: 0 20px;
    }

    /* Individual header labels */
    .header-main span {
      padding: 0px 0px;
      text-align: center;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      color: #9ca3af;
      white-space: nowrap;
    }

    /* Make headers sortable */
    .header-main span.sortable {
      cursor: pointer;
      position: relative;
      user-select: none;
    }

    .header-main span.sortable::after {
      content: "↕";
      font-size: 0.6rem;
      opacity: 0.3;
      margin-left: 4px;
    }

    .header-main span.sortable.sorted-asc::after {
      content: "▲";
      opacity: 0.8;
    }

    .header-main span.sortable.sorted-desc::after {
      content: "▼";
      opacity: 0.8;
    }

    .table-wrapper {
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      overflow: auto;
      position: relative;
      width: min(var(--table-width), var(--table-max-width));
      max-height: var(--table-max-height);
      margin: 0 auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      table-layout: fixed;
    }

    thead {
      position: sticky;
      inset-block-start: 0;
      z-index: 2;
    }

    thead tr {
      background: #020617;
    }

    th,
    td {
      border-bottom: 1px solid rgba(30, 64, 175, 0.28);
      white-space: nowrap;
    }

    th {
      padding: 9px 12px;
      text-align: center;
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      color: #9ca3af;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    tr.parent-row {
      cursor: pointer;
      transition:
        background-color 140ms ease-out,
        transform 120ms ease-out,
        box-shadow 120ms ease-out;
    }

    tr.parent-row.row-band-1 {
      background-color: var(--row-1);
    }

    tr.parent-row.row-band-2 {
      background-color: var(--row-2);
    }

    tr.parent-row.row-band-3 {
      background-color: var(--row-3);
    }

    tr.parent-row:hover {
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.8);
      transform: translateY(-1px);
    }

    tr.parent-row>td {
      padding: 6px 10px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.4);
    }

    .bubble-row {
      margin: 0px 5px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      background: radial-gradient(circle at top left,
          rgba(15, 23, 42, 0.96),
          rgba(15, 23, 42, 0.98));
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.32);
      box-shadow:
        0 16px 34px rgba(0, 0, 0, 0.65),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(18px);
      transition:
        transform 150ms ease-out,
        box-shadow 150ms ease-out,
        border-color 150ms ease-out,
        background 150ms ease-out;
    }

    .bubble-row::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .bubble-main {
      display: grid;
      grid-template-columns:
        var(--col-1-width) var(--col-2-width) var(--col-3-width) var(--col-4-width) var(--col-5-width) var(--col-6-width) var(--col-7-width) var(--col-8-width) var(--col-9-width) var(--col-10-width) var(--col-11-width) var(--col-12-width) var(--col-13-width);
      align-items: center;
      gap: 0;
      position: relative;
      z-index: 1;
    }

    tr.parent-row:hover .bubble-row {
      transform: translateY(-1px);
      box-shadow:
        0 22px 40px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(148, 163, 184, 0.55);
    }

    tr.parent-row:hover .bubble-row.status-error {
      border-color: rgba(254, 202, 202, 0.9);
    }

    tr.parent-row:hover .bubble-row.status-warning {
      border-color: rgba(254, 243, 199, 0.95);
    }

    tr.parent-row:hover .bubble-row.status-success {
      border-color: rgba(187, 247, 208, 0.95);
    }

    .bubble-cell {
      position: relative;
      padding: 0 8px;
      text-align: center;
      color: #e5e7eb;
      font-size: 0.78rem;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    .bubble-main .bubble-cell+.bubble-cell::before {
      content: "";
      position: absolute;
      inset-block: 24%;
      inset-inline-start: 0;
      width: 1px;
      background: radial-gradient(circle, rgba(15, 23, 42, 0.2), transparent);
      opacity: 0.8;
    }

    .bubble-main .bubble-cell:nth-child(2),
    .bubble-main .bubble-cell:nth-child(3) {
      font-weight: 600;
      color: #f9fafb;
    }

    .bubble-main .bubble-cell:nth-child(n + 5) {
      color: rgba(226, 232, 240, 0.88);
    }

    /* Last column: center its contents */
    .bubble-main .bubble-cell:last-child {
      text-align: left;
    }

    /* Status pill (bullet + text) */
    .status-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.45rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      font-size: 0.72rem;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      display: inline-block;
      flex-shrink: 0;
    }

    .status-text {
      white-space: nowrap;
    }

    .bubble-extra {
      display: none;
      padding-top: 10px;
      border-top: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 0.78rem;
      color: var(--text-muted);
      z-index: 1;
    }

    .bubble-row.expanded {
      overflow: visible;
      border-radius: 20px;
      box-shadow:
        0 22px 40px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(148, 163, 184, 0.55);
    }

    .bubble-row.expanded .bubble-extra {
      display: block;
    }

    .bubble-extra .child-columns {
      display: grid;
      /* grid-template-columns: 46% 27% 26%; */
      grid-template-columns: 33% 33% 33%;
      gap: 18px;
      width: 100%;
    }

    .bubble-extra .child-col {
      /* no flex here anymore */
      font-size: 0.75rem;
      line-height: 1.4;
      color: #cbd5f5;
    }

    .bubble-extra .child-col-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 0px 10px;
    }

    .bubble-extra .sub-cell {
      white-space: nowrap;
      font-size: 0.74rem;
    }

    .bubble-row.status-error {
      background: radial-gradient(circle at top left, #7f1d1d, #7f1d1d);
      border-color: rgba(254, 202, 202, 0.6);
      box-shadow:
        0 18px 36px rgba(127, 29, 29, 0.8),
        0 0 0 1px rgba(24, 24, 27, 0.9);
    }

    .bubble-row.status-error .bubble-cell {
      color: var(--status-error-text);
    }

    .bubble-row.status-warning {
      background: radial-gradient(circle at top left, #78350f, #78350f);
      border-color: rgba(254, 243, 199, 0.65);
      box-shadow:
        0 18px 36px rgba(120, 53, 15, 0.85),
        0 0 0 1px rgba(24, 24, 27, 0.9);
    }

    .bubble-row.status-warning .bubble-cell {
      color: var(--status-warning-text);
    }

    .bubble-row.status-success {
      background: radial-gradient(circle at top left, #065f46, #065f46);
      border-color: rgba(187, 247, 208, 0.65);
      box-shadow:
        0 18px 36px rgba(6, 95, 70, 0.85),
        0 0 0 1px rgba(24, 24, 27, 0.9);
    }

    .bubble-row.status-success .bubble-cell {
      color: var(--status-success-text);
    }

    /* Bullet colors per status */
    .bubble-row.status-error .status-dot {
      background: #fecaca;
    }

    .bubble-row.status-warning .status-dot {
      background: #fde68a;
    }

    .bubble-row.status-success .status-dot {
      background: #bbf7d0;
    }

    .child-columns .child-col {
      border-right: 1px solid rgba(148, 163, 184, 0.85);
      padding-right: 12px;
    }

    .child-col-heading {
      font-weight: 700;
      margin-bottom: 6px;
      text-align: center;
      padding-bottom: 4px;
      display: inline-block;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      position: relative;
      left: 50%;
      transform: translateX(-50%);
    }


    .child-columns .child-col:last-child {
      border-right: none;
    }

    .child-col-grid .sub-cell {
      border-right: 2px solid rgba(148, 163, 184, 0.3);
      text-align: center;
      padding-right: 6px;
    }

    .child-col-grid .sub-cell:nth-child(4n) {
      border-right: none;
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.3rem;
      }

      .card {
        padding: 14px 12px 8px;
      }

      .bubble-extra .child-columns {
        flex-direction: column;
      }
    }

    .metric-header {
      line-height: 1.1;
    }

    .metric-label {
      font-size: 0.6rem;
      opacity: 0.55;
    }

    /* default: Avg a bit bolder everywhere, even before sorting */
    .metric-header .metric-label[data-role="avg"] {
      font-weight: 600;
      opacity: 0.85;
    }

    /* to show which header is currently selected for sorting */
    .header-main span.sortable.active-column {
      color: #e5e7eb;
    }

    .metric-stack {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .metric-row {
      font-size: 0.72rem;
      line-height: 1.05;
      opacity: 0.65;
    }

    .metric-label.phase-active {
      color: #facc15;
      opacity: 1;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <header>
      <h1>Modern Table — 3-Color Stripe Rows</h1>
    </header>
    <section class="card">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th colspan="13" class="header-cell-wrapper">
                <div class="header-main">
                  <span class="sortable" data-col="0">ISO Filename</span>
                  <span class="sortable" data-col="1">Name</span>
                  <span class="sortable" data-col="2">ShortCode</span>
                  <span class="sortable" data-col="3">Version</span>
                  <span class="sortable" data-col="4">Avg<br />Benchmark</span>

                  <!-- Motionmark metric header -->
                  <span class="sortable metric-header" data-col="5" data-metric="motionmark">
                    Motion<br />Mark<br /><br />
                    <span class="metric-label" data-role="max">Max</span><br />
                    <span class="metric-label" data-role="avg">Avg</span><br />
                    <span class="metric-label" data-role="min">Min</span>
                  </span>

                  <!-- Jetstream metric header -->
                  <span class="sortable metric-header" data-col="6" data-metric="jetstream">
                    Jet<br />Stream<br /><br />
                    <span class="metric-label" data-role="max">Max</span><br />
                    <span class="metric-label" data-role="avg">Avg</span><br />
                    <span class="metric-label" data-role="min">Min</span>
                  </span>

                  <!-- Speedometer metric header -->
                  <span class="sortable metric-header" data-col="7" data-metric="speedometer">
                    Speedo<br />Meter<br /><br />
                    <span class="metric-label" data-role="max">Max</span><br />
                    <span class="metric-label" data-role="avg">Avg</span><br />
                    <span class="metric-label" data-role="min">Min</span>
                  </span>

                  <span class="sortable" data-col="8">Passmark</span>
                  <span class="sortable" data-col="9">Used<br />Space</span>
                  <span class="sortable" data-col="10">ISO Size</span>
                  <span class="sortable" data-col="11">Last<br />Modified</span>
                  <span class="sortable" data-col="12">Status</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="benchmarks-table">
          </tbody>
        </table>
      </div>
    </section>
  </div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.getElementById("benchmarks-table");
      const headerSpans = document.querySelectorAll(".header-main span.sortable");
      const metricColumns = new Set([5, 6, 7]); // Motionmark, Jetstream, Speedometer

      // Store which phase is visible/used for each metric column (default: avg)
      const metricPhaseByCol = {
        5: "avg",
        6: "avg",
        7: "avg",
      };

      function updateMetricDisplay() {
        // 1) Update which metric row is visible in each metric column
        metricColumns.forEach((colIndex) => {
          const phase = metricPhaseByCol[colIndex];
          const rows = tbody.querySelectorAll("tr.parent-row");
          rows.forEach((row) => {
            const cell = row.querySelectorAll(".bubble-main .bubble-cell")[colIndex];
            if (!cell) return;
            const metricRows = cell.querySelectorAll(".metric-row");
            metricRows.forEach((m) => {
              if (m.dataset.role === phase) {
                m.style.display = "block";
              } else {
                m.style.display = "none";
              }
            });
          });
        });

        // 2) Highlight the selected Max/Avg/Min in the header
        // Clear existing header highlights
        document
          .querySelectorAll(".metric-label.phase-active")
          .forEach((lbl) => lbl.classList.remove("phase-active"));

        // Apply highlight based on metricPhaseByCol
        metricColumns.forEach((colIndex) => {
          const phase = metricPhaseByCol[colIndex];
          const header = document.querySelector(
            `.header-main span.sortable[data-col="${colIndex}"]`
          );
          if (!header) return;
          const label = header.querySelector(`.metric-label[data-role="${phase}"]`);
          if (label) {
            label.classList.add("phase-active");
          }
        });
      }

      // Helpers
      const safe = (v) =>
        v === null || v === undefined || v === "" ? "&nbsp;" : v;

      const statusClass = (status) =>
        status ? "status-" + status.toLowerCase() : "";

      const toInt = (v) => {
        if (!v) return "&nbsp;";
        const num = parseFloat(v);
        return isNaN(num) ? safe(v) : Math.floor(num); // keep integer part only
      };

      const extractNumeric = (v) => parseFloat(v) || 0;
      const sortWithExtraction = (arr) =>
        arr.filter((v) => v).sort((a, b) => extractNumeric(a) - extractNumeric(b));
      // -----------------------------
      // 1) LOAD ROWS FROM JSON
      // -----------------------------
      async function loadBenchmarks() {
        try {
          const response = await fetch("data_benchmarks.json");
          const data = await response.json();

          data.forEach((row, index) => {
            const tr = document.createElement("tr");

            const rowBandClass = "row-band-" + ((index % 3) + 1);
            const statusText = row.status || "";
            const bubbleStatusClass = statusClass(statusText);

            const motionValues =
              (row.motionmark && row.motionmark.values) || new Array(20).fill("");

            const jetValues =
              (row.jetstream && row.jetstream.values) || new Array(20).fill("");

            const speedValues =
              (row.speedometer && row.speedometer.values) || new Array(20).fill("");

            // Sort the values
            const sortedMotionValues = sortWithExtraction(motionValues);
            const sortedJetValues = sortWithExtraction(jetValues);
            const sortedSpeedValues = sortWithExtraction(speedValues);

            const motionGridHtml = sortedMotionValues
              .map((v) => `<div class="sub-cell">${toInt(v)}</div>`)
              .join("");

            const jetGridHtml = sortedJetValues
              .map((v) => `<div class="sub-cell">${toInt(v)}</div>`)
              .join("");

            const speedGridHtml = sortedSpeedValues
              .map((v) => `<div class="sub-cell">${safe(v)}</div>`)
              .join("");


            tr.className = `parent-row ${rowBandClass}`;
            tr.innerHTML = `
              <td colspan="13">
                <div class="bubble-row ${bubbleStatusClass}">
                  <div class="bubble-main">
                    <span class="bubble-cell">${safe(row.iso_file_name)}</span>
                    <span class="bubble-cell">${safe(row.name)}</span>
                    <span class="bubble-cell">${safe(row.version_shortcode)}</span>
                    <span class="bubble-cell">${safe(row.version)}</span>
                    <span class="bubble-cell">${safe(row.benchmark_avg)}</span>

                    <span class="bubble-cell">
                      <div class="metric-stack" data-metric="motionmark">
                        <div class="metric-row" data-role="max">${toInt(row.motionmark?.highest)}</div>
                        <div class="metric-row" data-role="avg">${toInt(row.motionmark?.average)}</div>
                        <div class="metric-row" data-role="min">${toInt(row.motionmark?.lowest)}</div>
                      </div>
                    </span>

                    <span class="bubble-cell">
                      <div class="metric-stack" data-metric="jetstream">
                        <div class="metric-row" data-role="max">${toInt(row.jetstream?.highest)}</div>
                        <div class="metric-row" data-role="avg">${toInt(row.jetstream?.average)}</div>
                        <div class="metric-row" data-role="min">${toInt(row.jetstream?.lowest)}</div>
                      </div>
                    </span>

                    <span class="bubble-cell">
                      <div class="metric-stack" data-metric="speedometer">
                        <div class="metric-row" data-role="max">${safe(row.speedometer?.highest)}</div>
                        <div class="metric-row" data-role="avg">${safe(row.speedometer?.average)}</div>
                        <div class="metric-row" data-role="min">${safe(row.speedometer?.lowest)}</div>
                      </div>
                    </span>

                    <span class="bubble-cell">${safe(row.passmark)}</span>
                    <span class="bubble-cell">${safe(row.used_space)}</span>
                    <span class="bubble-cell">${safe(row.iso_file_size)}</span>
                    <span class="bubble-cell">${safe(row.iso_file_lastmodified)}</span>
                    <span class="bubble-cell">
                      <span class="status-pill">
                        <span class="status-dot"></span>
                        <span class="status-text">${safe(statusText)}</span>
                      </span>
                    </span>
                  </div>

                  <div class="bubble-extra">
                    <div class="child-columns">
                      <div class="child-col">
                        <div class="child-col-heading">&nbsp;&nbsp;Motionmark Data&nbsp;&nbsp;</div>
                        <div class="child-col-grid">
                          ${motionGridHtml}
                        </div>
                      </div>
                      <div class="child-col">
                        <div class="child-col-heading">&nbsp;&nbsp;Jetstream Data&nbsp;&nbsp;</div>
                        <div class="child-col-grid">
                          ${jetGridHtml}
                        </div>
                      </div>
                      <div class="child-col">
                        <div class="child-col-heading">&nbsp;&nbsp;Speedometer Data&nbsp;&nbsp;</div>
                        <div class="child-col-grid">
                          ${speedGridHtml}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            `;

            tbody.appendChild(tr);
          });
          updateMetricDisplay();
        } catch (err) {
          console.error("Failed to load benchmarks JSON:", err);
        }
      }

      // -----------------------------
      // 2) ROW EXPAND/COLLAPSE (DELEGATED)
      // -----------------------------
      tbody.addEventListener("click", (e) => {
        const row = e.target.closest("tr.parent-row");
        if (!row) return;

        const bubble = row.querySelector(".bubble-row");
        if (!bubble) return;

        const isExpanded = bubble.classList.contains("expanded");

        // close all
        document
          .querySelectorAll(".bubble-row.expanded")
          .forEach((b) => b.classList.remove("expanded"));

        // toggle current
        if (!isExpanded) {
          bubble.classList.add("expanded");
        }
      });

      // -----------------------------
      // 3) SORTING (click Max/Avg/Min + arrows)
      // -----------------------------
      let sortState = {
        colIndex: null,   // which column
        direction: "asc", // "asc" | "desc"
      };

      function getCellValue(row, colIndex, phase) {
        const cell = row.querySelectorAll(".bubble-main .bubble-cell")[colIndex];
        if (!cell) return "";

        if (metricColumns.has(colIndex) && phase) {
          const metricRow = cell.querySelector(`.metric-row[data-role="${phase}"]`);
          return metricRow ? metricRow.textContent.trim() : "";
        }

        return cell.textContent.trim();
      }

      function numericOrTextCompare(aVal, bVal) {
        const aNum = parseFloat(aVal);
        const bNum = parseFloat(bVal);

        if (!isNaN(aNum) && !isNaN(bNum)) {
          if (aNum < bNum) return -1;
          if (aNum > bNum) return 1;
          return 0;
        }

        return aVal.localeCompare(bVal, undefined, {
          numeric: true,
          sensitivity: "base",
        });
      }

      function clearSortStyles() {
        headerSpans.forEach((span) => {
          span.classList.remove("sorted-asc", "sorted-desc", "active-column");
        });
      }

      function doSort() {
        const colIndex = sortState.colIndex;
        if (colIndex == null) return;

        const rows = Array.from(tbody.querySelectorAll("tr.parent-row"));
        const phase = metricColumns.has(colIndex) ? metricPhaseByCol[colIndex] : null;

        rows.sort((a, b) => {
          const aVal = getCellValue(a, colIndex, phase);
          const bVal = getCellValue(b, colIndex, phase);

          let cmp = numericOrTextCompare(aVal, bVal);
          return sortState.direction === "asc" ? cmp : -cmp;
        });

        rows.forEach((row, idx) => {
          row.classList.remove("row-band-1", "row-band-2", "row-band-3");
          row.classList.add(`row-band-${(idx % 3) + 1}`);
          tbody.appendChild(row);
        });

        clearSortStyles();

        const header = document.querySelector(
          `.header-main span.sortable[data-col="${colIndex}"]`
        );
        if (header) {
          header.classList.add("active-column");
          header.classList.add(
            sortState.direction === "asc" ? "sorted-asc" : "sorted-desc"
          );
        }

        // Ensure only selected Min/Avg/Max are visible
        updateMetricDisplay();
      }

      // Header click handling
      headerSpans.forEach((span) => {
        span.addEventListener("click", (e) => {
          e.stopPropagation();

          const colIndex = parseInt(span.dataset.col, 10);
          if (Number.isNaN(colIndex)) return;

          const isMetric = metricColumns.has(colIndex);
          const clickedLabel = e.target.closest(".metric-label");

          // --- METRIC LABEL CLICK (Max / Avg / Min) ---
          if (isMetric && clickedLabel) {
            const newPhase = clickedLabel.dataset.role; // "max" | "avg" | "min"

            if (
              sortState.colIndex === colIndex &&
              metricPhaseByCol[colIndex] === newPhase
            ) {
              // Same column + same phase: toggle direction
              sortState.direction =
                sortState.direction === "asc" ? "desc" : "asc";
            } else {
              // New column OR different phase
              if (sortState.colIndex !== colIndex) {
                sortState.colIndex = colIndex;
                sortState.direction = "asc"; // default when switching column
              }
              metricPhaseByCol[colIndex] = newPhase; // store visible/sort phase for this column
            }

            doSort();
            return;
          }

          // --- HEADER / ARROW CLICK (▲ / ▼ area) ---
          if (sortState.colIndex === colIndex) {
            // Same column: toggle direction
            sortState.direction =
              sortState.direction === "asc" ? "desc" : "asc";
          } else {
            // New column selected
            sortState.colIndex = colIndex;
            sortState.direction = "asc";
            // No need to touch metricPhaseByCol here: it already has defaults ("avg")
          }

          doSort();
        });
      });

      // Finally: load data
      loadBenchmarks();
    });
  </script>

</body>

</html>