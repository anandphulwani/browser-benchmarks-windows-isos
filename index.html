<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Modern 3-Color Bubble Table</title>
  <style>
    :root {
      --border-soft: #1e293b;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      /* 3-row band colors */
      --row-1: #062a35;
      --row-2: #0a435d;
      --row-3: #0d5f89;
      /* Status colors (text only) */
      --status-error-text: #fecaca;
      --status-warning-text: #fef3c7;
      --status-success-text: #bbf7d0;
      /* per-column widths (px or %) */
      --col-1-width: 10%;
      --col-2-width: 5%;
      --col-3-width: 5%;
      --col-4-width: 5%;
      --col-5-width: 5%;
      --col-6-width: 5%;
      --col-7-width: 5%;
      --col-8-width: 5%;
      --col-9-width: 5%;
      --col-10-width: 5%;
      --col-11-width: 5%;
      --col-12-width: 5%;
      --col-13-width: 5%;
      --col-14-width: 5%;
      --col-15-width: 5%;
      --col-16-width: 5%;
      --col-17-width: 5%;
      --col-18-width: 5%;
      --col-19-width: 5%;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #020617;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .wrapper {
      width: 100%;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: clamp(1.7rem, 2.5vw, 2.2rem);
      margin: 0 0 6px;
      letter-spacing: 0.04em;
    }

    .card {
      background: radial-gradient(circle at top left, #4B5D6E, #4B5D6E);
      border-radius: 18px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.06);
      padding: 18px 18px 18px;
      overflow: hidden;
      backdrop-filter: blur(16px);
    }

    /* Header wrapper cell */
    .header-cell-wrapper {
      background-color: #111a27;
      padding: 20;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    /* Header grid that matches bubble-main */
    .header-main {
      display: grid;
      grid-template-columns:
        var(--col-1-width) var(--col-2-width) var(--col-3-width) var(--col-4-width) var(--col-5-width) var(--col-6-width) var(--col-7-width) var(--col-8-width) var(--col-9-width) var(--col-10-width) var(--col-11-width) var(--col-12-width) var(--col-13-width) var(--col-14-width) var(--col-15-width) var(--col-16-width) var(--col-17-width) var(--col-18-width) var(--col-19-width);
      margin: 0 20px;
    }

    /* Individual header labels */
    .header-main span {
      padding: 0px 0px;
      text-align: center;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      color: #9ca3af;
      white-space: nowrap;
    }

    /* Make headers sortable */
    .header-main span.sortable {
      cursor: pointer;
      position: relative;
      user-select: none;
    }

    .header-main span.sortable::after {
      content: "↕";
      font-size: 0.6rem;
      opacity: 0.3;
      margin-left: 4px;
    }

    .header-main span.sortable.sorted-asc::after {
      content: "▲";
      opacity: 0.8;
    }

    .header-main span.sortable.sorted-desc::after {
      content: "▼";
      opacity: 0.8;
    }

    .table-wrapper {
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      overflow: auto;
      position: relative;
      width: min(var(--table-width), var(--table-max-width));
      max-height: var(--table-max-height);
      margin: 0 auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      table-layout: fixed;
    }

    thead {
      position: sticky;
      inset-block-start: 0;
      z-index: 2;
    }

    thead tr {
      background: #020617;
    }

    th,
    td {
      border-bottom: 1px solid rgba(30, 64, 175, 0.28);
      white-space: nowrap;
    }

    th {
      padding: 9px 12px;
      text-align: center;
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      color: #9ca3af;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    tr.parent-row {
      cursor: pointer;
      transition:
        background-color 140ms ease-out,
        transform 120ms ease-out,
        box-shadow 120ms ease-out;
    }

    tr.parent-row.row-band-1 {
      background-color: var(--row-1);
    }

    tr.parent-row.row-band-2 {
      background-color: var(--row-2);
    }

    tr.parent-row.row-band-3 {
      background-color: var(--row-3);
    }

    tr.parent-row:hover {
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.8);
      transform: translateY(-1px);
    }

    tr.parent-row>td {
      padding: 6px 10px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.4);
    }

    .bubble-row {
      margin: 0px 5px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      background: radial-gradient(circle at top left,
          rgba(15, 23, 42, 0.96),
          rgba(15, 23, 42, 0.98));
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.32);
      box-shadow:
        0 16px 34px rgba(0, 0, 0, 0.65),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(18px);
      transition:
        transform 150ms ease-out,
        box-shadow 150ms ease-out,
        border-color 150ms ease-out,
        background 150ms ease-out;
    }

    .bubble-row::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .bubble-main {
      display: grid;
      grid-template-columns:
        var(--col-1-width) var(--col-2-width) var(--col-3-width) var(--col-4-width) var(--col-5-width) var(--col-6-width) var(--col-7-width) var(--col-8-width) var(--col-9-width) var(--col-10-width) var(--col-11-width) var(--col-12-width) var(--col-13-width) var(--col-14-width) var(--col-15-width) var(--col-16-width) var(--col-17-width) var(--col-18-width) var(--col-19-width);
      align-items: center;
      gap: 0;
      position: relative;
      z-index: 1;
    }

    tr.parent-row:hover .bubble-row {
      transform: translateY(-1px);
      box-shadow:
        0 22px 40px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(148, 163, 184, 0.55);
    }

    tr.parent-row:hover .bubble-row.status-error {
      border-color: rgba(254, 202, 202, 0.9);
    }

    tr.parent-row:hover .bubble-row.status-warning {
      border-color: rgba(254, 243, 199, 0.95);
    }

    tr.parent-row:hover .bubble-row.status-success {
      border-color: rgba(187, 247, 208, 0.95);
    }

    .bubble-cell {
      position: relative;
      padding: 0 8px;
      text-align: center;
      color: #e5e7eb;
      font-size: 0.78rem;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    .bubble-main .bubble-cell+.bubble-cell::before {
      content: "";
      position: absolute;
      inset-block: 24%;
      inset-inline-start: 0;
      width: 1px;
      background: radial-gradient(circle, rgba(15, 23, 42, 0.2), transparent);
      opacity: 0.8;
    }

    .bubble-main .bubble-cell:nth-child(2),
    .bubble-main .bubble-cell:nth-child(3) {
      font-weight: 600;
      color: #f9fafb;
    }

    .bubble-main .bubble-cell:nth-child(n + 5) {
      color: rgba(226, 232, 240, 0.88);
    }

    /* Last column: center its contents */
    .bubble-main .bubble-cell:last-child {
      text-align: left;
    }

    /* Status pill (bullet + text) */
    .status-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.45rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      font-size: 0.72rem;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      display: inline-block;
      flex-shrink: 0;
    }

    .status-text {
      white-space: nowrap;
    }

    .bubble-extra {
      display: none;
      padding-top: 10px;
      border-top: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 0.78rem;
      color: var(--text-muted);
      z-index: 1;
    }

    .bubble-row.expanded {
      overflow: visible;
      border-radius: 20px;
      box-shadow:
        0 22px 40px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(148, 163, 184, 0.55);
    }

    .bubble-row.expanded .bubble-extra {
      display: block;
    }

    .bubble-extra .child-columns {
      display: grid;
      /* grid-template-columns: 46% 27% 26%; */
      grid-template-columns: 33% 33% 33%;
      gap: 18px;
      width: 100%;
    }

    .bubble-extra .child-col {
      /* no flex here anymore */
      font-size: 0.75rem;
      line-height: 1.4;
      color: #cbd5f5;
    }

    .bubble-extra .child-col-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 0px 10px;
    }

    .bubble-extra .sub-cell {
      white-space: nowrap;
      font-size: 0.74rem;
    }

    .bubble-row.status-error {
      background: radial-gradient(circle at top left, #7f1d1d, #7f1d1d);
      border-color: rgba(254, 202, 202, 0.6);
      box-shadow:
        0 18px 36px rgba(127, 29, 29, 0.8),
        0 0 0 1px rgba(24, 24, 27, 0.9);
    }

    .bubble-row.status-error .bubble-cell {
      color: var(--status-error-text);
    }

    .bubble-row.status-warning {
      background: radial-gradient(circle at top left, #78350f, #78350f);
      border-color: rgba(254, 243, 199, 0.65);
      box-shadow:
        0 18px 36px rgba(120, 53, 15, 0.85),
        0 0 0 1px rgba(24, 24, 27, 0.9);
    }

    .bubble-row.status-warning .bubble-cell {
      color: var(--status-warning-text);
    }

    .bubble-row.status-success {
      background: radial-gradient(circle at top left, #065f46, #065f46);
      border-color: rgba(187, 247, 208, 0.65);
      box-shadow:
        0 18px 36px rgba(6, 95, 70, 0.85),
        0 0 0 1px rgba(24, 24, 27, 0.9);
    }

    .bubble-row.status-success .bubble-cell {
      color: var(--status-success-text);
    }

    /* Bullet colors per status */
    .bubble-row.status-error .status-dot {
      background: #fecaca;
    }

    .bubble-row.status-warning .status-dot {
      background: #fde68a;
    }

    .bubble-row.status-success .status-dot {
      background: #bbf7d0;
    }

    .child-columns .child-col {
      border-right: 1px solid rgba(148, 163, 184, 0.85);
      padding-right: 12px;
    }

    .child-col-heading {
      font-weight: 700;
      margin-bottom: 6px;
      text-align: center;
      padding-bottom: 4px;
      display: inline-block;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      position: relative;
      left: 50%;
      transform: translateX(-50%);
    }


    .child-columns .child-col:last-child {
      border-right: none;
    }

    .child-col-grid .sub-cell {
      border-right: 2px solid rgba(148, 163, 184, 0.3);
      text-align: center;
      padding-right: 6px;
    }

    .child-col-grid .sub-cell:nth-child(4n) {
      border-right: none;
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.3rem;
      }

      .card {
        padding: 14px 12px 8px;
      }

      .bubble-extra .child-columns {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <header>
      <h1>Modern Table — 3-Color Stripe Rows</h1>
    </header>
    <section class="card">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th colspan="19" class="header-cell-wrapper">
                <div class="header-main">
                  <span class="sortable" data-col="0">ISO Filename</span>
                  <span class="sortable" data-col="1">Name</span>
                  <span class="sortable" data-col="2">ShortCode</span>
                  <span class="sortable" data-col="3">Version</span>
                  <span class="sortable" data-col="4">Avg.<br />Bench<br />mark</span>
                  <span class="sortable" data-col="5">Avg.<br />Motion<br />mark</span>
                  <span class="sortable" data-col="6">Avg.<br />Jet<br />Stream</span>
                  <span class="sortable" data-col="7">Avg.<br />Speedo<br />meter</span>
                  <span class="sortable" data-col="8">Max.<br />Motion<br />mark</span>
                  <span class="sortable" data-col="9">Max.<br />Jet<br />Stream</span>
                  <span class="sortable" data-col="10">Max.<br />Speedo<br />meter</span>
                  <span class="sortable" data-col="11">Min.<br />Motion<br />mark</span>
                  <span class="sortable" data-col="12">Min.<br />Jet<br />Stream</span>
                  <span class="sortable" data-col="13">Min.<br />Speedo<br />meter</span>
                  <span class="sortable" data-col="14">Passmark</span>
                  <span class="sortable" data-col="15">Used<br />Space</span>
                  <span class="sortable" data-col="16">ISO Size</span>
                  <span class="sortable" data-col="17">Last<br />Modified</span>
                  <span class="sortable" data-col="18">Status</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="benchmarks-table">
            <!-- Row 1 -->
            <!-- tr class="parent-row row-band-1">
              <td colspan="19">
                <div class="bubble-row status-error">
                  <div class="bubble-main">
                    <span class="bubble-cell">Alpha.iso</span>
                    <span class="bubble-cell">Alpha</span>
                    <span class="bubble-cell">Item 01</span>
                    <span class="bubble-cell">v1.0</span>
                    <span class="bubble-cell">100</span>
                    <span class="bubble-cell">326</span>
                    <span class="bubble-cell">180</span>
                    <span class="bubble-cell">10.07</span>
                    <span class="bubble-cell">350</span>
                    <span class="bubble-cell">210</span>
                    <span class="bubble-cell">12.00</span>
                    <span class="bubble-cell">301</span>
                    <span class="bubble-cell">150</span>
                    <span class="bubble-cell">8.00</span>
                    <span class="bubble-cell">345</span>
                    <span class="bubble-cell">20.12 GB</span>
                    <span class="bubble-cell">4.7 GB</span>
                    <span class="bubble-cell">2025-01-01</span>
                    <span class="bubble-cell">
                      <span class="status-pill">
                        <span class="status-dot"></span>
                        <span class="status-text">Error</span>
                      </span>
                    </span>
                  </div>
                  <div class="bubble-extra">
                    <div class="child-columns">
                      <div class="child-col">
                        <div class="child-col-heading">&nbsp;&nbsp;Motionmark Data&nbsp;&nbsp;</div>
                        <div class="child-col-grid">
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                          <div class="sub-cell">&nbsp;</div>
                        </div>
                      </div>
                      <div class="child-col">
                        <div class="child-col-heading">&nbsp;&nbsp;Jetstream Data&nbsp;&nbsp;</div>
                        <div class="child-col-grid">
                          <div class="sub-cell">178.49</div>
                          <div class="sub-cell">177.22</div>
                          <div class="sub-cell">175.15</div>
                          <div class="sub-cell">176.17</div>
                          <div class="sub-cell">175.75</div>
                          <div class="sub-cell">179.57</div>
                          <div class="sub-cell">177.69</div>
                          <div class="sub-cell">178.29</div>
                          <div class="sub-cell">178.18</div>
                          <div class="sub-cell">175.90</div>
                          <div class="sub-cell">178.30</div>
                          <div class="sub-cell">175.36</div>
                          <div class="sub-cell">178.68</div>
                          <div class="sub-cell">176.06</div>
                          <div class="sub-cell">175.21</div>
                          <div class="sub-cell">173.99</div>
                          <div class="sub-cell">178.51</div>
                          <div class="sub-cell">178.63</div>
                          <div class="sub-cell">179.08</div>
                          <div class="sub-cell">177.25</div>
                        </div>
                      </div>
                      <div class="child-col">
                        <div class="child-col-heading">&nbsp;&nbsp;Speedometer Data&nbsp;&nbsp;</div>
                        <div class="child-col-grid">
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.70</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.70</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.50</div>
                          <div class="sub-cell">11.50</div>
                          <div class="sub-cell">11.80</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.80</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.50</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.70</div>
                          <div class="sub-cell">11.60</div>
                          <div class="sub-cell">11.70</div>
                          <div class="sub-cell">11.50</div>
                          <div class="sub-cell">11.50</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr -->
            <!-- Row 2 -->
            <!-- tr class="parent-row row-band-2">
              <td colspan="19">
                <div class="bubble-row status-warning">
                  <div class="bubble-main">
                    <span class="bubble-cell">Bravo.iso</span>
                    <span class="bubble-cell">Bravo</span>
                    <span class="bubble-cell">Item 02</span>
                    <span class="bubble-cell">v1.1</span>
                    <span class="bubble-cell">88</span>
                    <span class="bubble-cell">210</span>
                    <span class="bubble-cell">170</span>
                    <span class="bubble-cell">110</span>
                    <span class="bubble-cell">1400</span>
                    <span class="bubble-cell">118GB</span>
                    <span class="bubble-cell">4.3GB</span>
                    <span class="bubble-cell">2025-01-02</span>
                    <span class="bubble-cell">
                      <span class="status-pill">
                        <span class="status-dot"></span>
                        <span class="status-text">Warning</span>
                      </span>
                    </span>
                  </div>
                  <div class="bubble-extra">Row 2 child content...</div>
                </div>
              </td>
            </tr -->
            <!-- Row 3 -->
            <!-- tr class="parent-row row-band-3">
              <td colspan="19">
                <div class="bubble-row status-success">
                  <div class="bubble-main">
                    <span class="bubble-cell">Charlie.iso</span>
                    <span class="bubble-cell">Charlie</span>
                    <span class="bubble-cell">Item 03</span>
                    <span class="bubble-cell">v2.0</span>
                    <span class="bubble-cell">99</span>
                    <span class="bubble-cell">230</span>
                    <span class="bubble-cell">190</span>
                    <span class="bubble-cell">130</span>
                    <span class="bubble-cell">1600</span>
                    <span class="bubble-cell">125GB</span>
                    <span class="bubble-cell">4.9GB</span>
                    <span class="bubble-cell">2025-01-03</span>
                    <span class="bubble-cell">
                      <span class="status-pill">
                        <span class="status-dot"></span>
                        <span class="status-text">Success</span>
                      </span>
                    </span>
                  </div>
                  <div class="bubble-extra">Row 3 child content...</div>
                </div>
              </td>
            </tr -->

          </tbody>
        </table>
      </div>
    </section>
  </div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.getElementById("benchmarks-table");
      const headerSpans = document.querySelectorAll(".header-main span.sortable");

      // Helpers
      const safe = (v) =>
        v === null || v === undefined || v === "" ? "&nbsp;" : v;

      const statusClass = (status) =>
        status ? "status-" + status.toLowerCase() : "";

      const toInt = (v) => {
        if (!v) return "&nbsp;";
        const num = parseFloat(v);
        return isNaN(num) ? safe(v) : Math.floor(num); // keep integer part only
      };

      const extractNumeric = (v) => parseFloat(v) || 0;
      const sortWithExtraction = (arr) =>
        arr.filter((v) => v).sort((a, b) => extractNumeric(a) - extractNumeric(b));
      // -----------------------------
      // 1) LOAD ROWS FROM JSON
      // -----------------------------
      async function loadBenchmarks() {
        try {
          const response = await fetch("data_benchmarks.json");
          const data = await response.json();

          data.forEach((row, index) => {
            const tr = document.createElement("tr");

            const rowBandClass = "row-band-" + ((index % 3) + 1);
            const statusText = row.status || "Unknown";
            const bubbleStatusClass = statusClass(statusText);

            const motionValues =
              (row.motionmark && row.motionmark.values) || new Array(20).fill("");

            const jetValues =
              (row.jetstream && row.jetstream.values) || new Array(20).fill("");

            const speedValues =
              (row.speedometer && row.speedometer.values) || new Array(20).fill("");

            // Sort the values
            const sortedMotionValues = sortWithExtraction(motionValues);
            const sortedJetValues = sortWithExtraction(jetValues);
            const sortedSpeedValues = sortWithExtraction(speedValues);

            const motionGridHtml = sortedMotionValues
              .map((v) => `<div class="sub-cell">${toInt(v)}</div>`)
              .join("");

            const jetGridHtml = sortedJetValues
              .map((v) => `<div class="sub-cell">${toInt(v)}</div>`)
              .join("");

            const speedGridHtml = sortedSpeedValues
              .map((v) => `<div class="sub-cell">${safe(v)}</div>`)
              .join("");


            tr.className = `parent-row ${rowBandClass}`;
            tr.innerHTML = `
            <td colspan="19">
              <div class="bubble-row ${bubbleStatusClass}">
                <div class="bubble-main">
                  <!-- 19 columns, same order as THEAD -->
                  <span class="bubble-cell">${safe(row.iso_file_name)}</span>          <!-- 0 ISO Filename -->
                  <span class="bubble-cell">${safe(row.name)}</span>                   <!-- 1 Name -->
                  <span class="bubble-cell">${safe(row.version_shortcode)}</span>      <!-- 2 ShortCode -->
                  <span class="bubble-cell">${safe(row.version)}</span>                <!-- 3 Version -->
                  <span class="bubble-cell">${safe(row.benchmark_avg)}</span>          <!-- 4 Avg Benchmark -->
                  <span class="bubble-cell">${toInt(row.motionmark?.average)}</span>    <!-- 5 Avg Motionmark -->
                  <span class="bubble-cell">${toInt(row.jetstream?.average)}</span>     <!-- 6 Avg JetStream -->
                  <span class="bubble-cell">${safe(row.speedometer?.average)}</span>   <!-- 7 Avg Speedometer -->
                  <span class="bubble-cell">${toInt(row.motionmark?.highest)}</span>    <!-- 8 Max Motionmark -->
                  <span class="bubble-cell">${toInt(row.jetstream?.highest)}</span>     <!-- 9 Max JetStream -->
                  <span class="bubble-cell">${safe(row.speedometer?.highest)}</span>   <!-- 10 Max Speedometer -->
                  <span class="bubble-cell">${toInt(row.motionmark?.lowest)}</span>     <!-- 11 Min Motionmark -->
                  <span class="bubble-cell">${toInt(row.jetstream?.lowest)}</span>      <!-- 12 Min JetStream -->
                  <span class="bubble-cell">${safe(row.speedometer?.lowest)}</span>    <!-- 13 Min Speedometer -->
                  <span class="bubble-cell">${safe(row.passmark)}</span>               <!-- 14 Passmark -->
                  <span class="bubble-cell">${safe(row.used_space)}</span>             <!-- 15 Used Space -->
                  <span class="bubble-cell">${safe(row.iso_file_size)}</span>          <!-- 16 ISO Size -->
                  <span class="bubble-cell">${safe(row.iso_file_lastmodified)}</span>  <!-- 17 Last Modified -->
                  <span class="bubble-cell">                                           <!-- 18 Status -->
                    <span class="status-pill">
                      <span class="status-dot"></span>
                      <span class="status-text">${safe(statusText)}</span>
                    </span>
                  </span>
                </div>

                <div class="bubble-extra">
                  <div class="child-columns">
                    <div class="child-col">
                      <div class="child-col-heading">&nbsp;&nbsp;Motionmark Data&nbsp;&nbsp;</div>
                      <div class="child-col-grid">
                        ${motionGridHtml}
                      </div>
                    </div>
                    <div class="child-col">
                      <div class="child-col-heading">&nbsp;&nbsp;Jetstream Data&nbsp;&nbsp;</div>
                      <div class="child-col-grid">
                        ${jetGridHtml}
                      </div>
                    </div>
                    <div class="child-col">
                      <div class="child-col-heading">&nbsp;&nbsp;Speedometer Data&nbsp;&nbsp;</div>
                      <div class="child-col-grid">
                        ${speedGridHtml}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          `;

            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error("Failed to load benchmarks JSON:", err);
        }
      }

      // -----------------------------
      // 2) ROW EXPAND/COLLAPSE (DELEGATED)
      // -----------------------------
      tbody.addEventListener("click", (e) => {
        const row = e.target.closest("tr.parent-row");
        if (!row) return;

        const bubble = row.querySelector(".bubble-row");
        if (!bubble) return;

        const isExpanded = bubble.classList.contains("expanded");

        // close all
        document
          .querySelectorAll(".bubble-row.expanded")
          .forEach((b) => b.classList.remove("expanded"));

        // toggle current
        if (!isExpanded) {
          bubble.classList.add("expanded");
        }
      });

      // -----------------------------
      // 3) SORTING
      // -----------------------------
      let currentSort = {
        index: null,
        direction: "asc",
      };

      function getCellText(row, colIndex) {
        const cells = row.querySelectorAll(".bubble-main .bubble-cell");
        const cell = cells[colIndex];
        return cell ? cell.textContent.trim() : "";
      }

      function sortByColumn(colIndex) {
        const rows = Array.from(tbody.querySelectorAll("tr.parent-row"));

        // Toggle direction
        if (currentSort.index === colIndex) {
          currentSort.direction =
            currentSort.direction === "asc" ? "desc" : "asc";
        } else {
          currentSort.index = colIndex;
          currentSort.direction = "asc";
        }

        // Reset header classes
        headerSpans.forEach((span) => {
          span.classList.remove("sorted-asc", "sorted-desc");
        });
        const activeHeader = document.querySelector(
          `.header-main span.sortable[data-col="${colIndex}"]`
        );
        if (activeHeader) {
          activeHeader.classList.add(
            currentSort.direction === "asc" ? "sorted-asc" : "sorted-desc"
          );
        }

        // Sort rows
        rows.sort((a, b) => {
          const aText = getCellText(a, colIndex);
          const bText = getCellText(b, colIndex);

          let cmp = aText.localeCompare(bText, undefined, {
            numeric: true,
            sensitivity: "base",
          });

          return currentSort.direction === "asc" ? cmp : -cmp;
        });

        // Re-append rows and reassign band classes
        rows.forEach((row, idx) => {
          row.classList.remove("row-band-1", "row-band-2", "row-band-3");
          const band = (idx % 3) + 1;
          row.classList.add(`row-band-${band}`);
          tbody.appendChild(row);
        });
      }

      // Header click handlers
      headerSpans.forEach((span) => {
        span.addEventListener("click", (e) => {
          e.stopPropagation(); // don't trigger row expand
          const colIndex = parseInt(span.dataset.col, 10);
          if (!Number.isNaN(colIndex)) {
            sortByColumn(colIndex);
          }
        });
      });

      // Finally: load data
      loadBenchmarks();
    });
  </script>

</body>

</html>